# Changelog

## 2026-01-03
- Update module references to `rename_n_sort` across code, tests, CLI entrypoint, and docs.
- Add pytest `conftest.py` to ensure local package imports resolve without installation.
- Make Apple Foundation Models the primary macOS backend with Ollama fallback; remove DummyLLM fallback behavior.
- Process files one-by-one by default and simplify CLI flags accordingly.
- Rename console prefixes to `[SCAN]`, `[FILE]`, `[WHY]`, `[RENAME]`, and `[DEST]`, plus add per-file separators and shorter path display.
- Require Moondream2 captioning and OCR (pytesseract) for image metadata; include OCR text in summaries.
- Add `Brewfile`, clean and sort `pip_requirements.txt`, and add sample file generator + dependency availability tests.
- Remove `source_me_for_testing.sh`.
- Rename the distribution/CLI entrypoint to `llm-file-rename-n-sort`.
- Bundle Moondream2 captioning helpers directly in the repo to remove `OTHER_REPOS` dependencies.
- Rename `MacOSLocalLLM` to `AppleLLM`, rename the base class to `BaseClassLLM`, and add `--max-depth` (default 1).
- Add mutually-exclusive `--apply` and `--dry-run` flags (dry-run default) for safer CLI behavior.
- Default target root now uses `<search_root>/Organized` to keep files on the same drive unless `--target` is set.
- Clarify `--context` to indicate it is injected into LLM prompts with examples.
- Remove JSON/YAML config file support in favor of explicit CLI arguments.
- Switch XML parsing to a last-tag extraction strategy for chatty LLM outputs.
- Include caption + OCR context with guidance notes in rename prompts.
- Refine rename/keep prompts to emphasize human-readable filenames and reduce noisy tokens.
- For PDFs with two pages or fewer, render pages to images and use OCR+captioning instead of plain text extraction.
- Replace PDF rasterization via pyvips/libvips with pdf2image/poppler for more stable OCR rendering.
- Exclude `OTHER_REPOS` from pyflakes scanning to keep linting focused on this codebase.
- Remove the `cleaned/` path segment so targets are now `<target_root>/<category>/...`.
- Add OCR/rendering status and sample text logging for images and short PDFs.
- Avoid keeping numeric/generic original stems and normalize placeholder reasons.
- Let the LLM decide keep-original without extra heuristics; suppress placeholder keep reasons.
- Add a fallback LLM wrapper to use Ollama when Apple guardrails block content; skip files on LLM failures.
- Print PDF text samples under a [META] prefix and suppress duplicate desc output.
- Tighten keep-original prompts to reference the original stem explicitly and avoid metadata-based guesses.
- Rewrite keep-original prompt as a mechanical rule ladder with stem-quoted reasons.
- Refine keep-original ladder to favor real words and make machine-token tests explicit.
- Compute keep-original feature flags deterministically and pass them into the prompt for LLM decisions.
- Drop requirement that keep-original reasons quote the stem; require citing a feature flag.
- Show document summary text as [META] text sample instead of [WHY] desc.
- Add mutually exclusive randomize/sorted CLI ordering with randomize as the default.
- Adjust LLM prompts to request XML-only replies with minimal chatter.

## 2026-01-02
- Bump version to `26.01` and add root `VERSION` file synced with `pyproject.toml`.
- Lazy-import `ai_image_caption.moondream2` so optional caption dependencies load only when needed.
- Add `--one-by-one` mode to process each file through PLAN1/PLAN2 (and DRY RUN/APPLY) before starting the next file.
- Add `--llm-backend {macos,ollama}` to choose between the default macOS-local backend and Ollama.
- Print rename/keep/category decision details by default.
- Fix Ollama sorting-mode parsing to fill missing categories using the actual file indices in the batch (not `0..N-1`).
- Add tests for VERSION sync and keep-original heuristics, plus a CLI smoke script at `tests/run_smoke_cli.sh`.
- Fix pyflakes warnings (unused imports and duplicate dictionary keys).
- Update Ollama prompts/parsing to use an XML `<response>...</response>` block for robust extraction from chatty model outputs.
- Add repo-root runner script `run_file_cleanup.py`.
- Switch PDF parsing dependency from PyPDF2 to pypdf.
